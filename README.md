# Integration Hub "bisnesmedia"

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å (—Ö–∞–±) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ ¬´1–°: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π 11¬ª –∏ ¬´–ú–æ–π–°–∫–ª–∞–¥¬ª.

## Prerequisites

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è:
- [Docker](https://www.docker.com/) –∏ Docker Compose
- [Poetry](https://python-poetry.org/)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   git clone <your-repo-url>
   cd bisnesmedia-integration-hub
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
   ```bash
   cp .env.example .env
   ```
   > –í–∞–∂–Ω–æ: —Ñ–∞–π–ª `.env` –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π.

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   Poetry —Å–æ–∑–¥–∞—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã.
   ```bash
   poetry install
   ```

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `docker-compose.dev.yml` (hot-reload, –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤):

```bash
docker compose -f docker-compose.dev.yml up -d --build
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Swagger UI): http://localhost:8000/docs

–ó–¥–æ—Ä–æ–≤—å–µ:

```text
GET /            -> { status: ok }
GET /health/db   -> –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î
```

–ü–æ–¥—Å–∫–∞–∑–∫–∏:
- –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ, –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –±–µ–∑ –∫—ç—à–∞:

  ```bash
  docker compose -f docker-compose.dev.yml build --no-cache app
  docker compose -f docker-compose.dev.yml build --no-cache admin_panel
  docker compose -f docker-compose.dev.yml up -d
  ```

- –í dev –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `RUN_MIGRATIONS_ON_STARTUP=false` –≤ `.env`.

## –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª—å

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–∞ –±–∞–∑–µ Streamlit –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

### –ó–∞–ø—É—Å–∫ –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª–∏

```bash
# –í —Å–æ—Å—Ç–∞–≤–µ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞
docker compose -f docker-compose.dev.yml up -d --build admin_panel

# –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
docker compose -f docker-compose.dev.yml up admin_panel
```

–ü–∞–Ω–µ–ª—å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8501

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª–∏

**üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∂—É—Ä–Ω–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞–∫ —Å—Ç–∞—Ä–æ–π, —Ç–∞–∫ –∏ –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã –ª–æ–≥–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏, —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∏—Å—Ç–µ–º–∞, —Å—Ç–∞—Ç—É—Å, —à–∞–≥, run_id
- –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º (2-30 —Å–µ–∫—É–Ω–¥)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ (100-2000 –∑–∞–ø–∏—Å–µ–π)

**üìä –£–º–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- JSON-–ø—Ä–µ–≤—å—é —Å –æ–±—Ä–µ–∑–∫–æ–π –¥–ª–∏–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–¥–æ 1500 —Å–∏–º–≤–æ–ª–æ–≤)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –±–ª–æ–∫–∏ –¥–ª—è raw JSON –¥–∞–Ω–Ω—ã—Ö (`details`, `payload`)
- Fault-tolerant –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫

**üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:**
- CSV ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- NDJSON ‚Äî JSON –ø–æ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `ADMIN_DB_URL` ‚Äî URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `postgresql+psycopg2://user:password@db:5432/bisnesmedia`)
- `ADMIN_APP_URL` ‚Äî URL FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://app:8000`)
- `ADMIN_POLL_SECONDS` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 —Å–µ–∫)
- `ADMIN_PAGE_SIZE` ‚Äî —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 500 –∑–∞–ø–∏—Å–µ–π)
- `ADMIN_TRIGGER_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä—É—á–Ω–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –†—É—á–Ω–æ–µ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ü–∞–Ω–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
- üîÑ **–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏** ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- üöÄ **–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ü–µ–Ω–∫—É –¥–µ—Ñ–∏—Ü–∏—Ç–∞** ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–∫–∞–∑–∞–Ω–∏—è warehouse_id

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

- Graceful degradation –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –≤–º–µ—Å—Ç–æ –ø–∞–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤ Docker**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `db:5432` –≤–º–µ—Å—Ç–æ `localhost:5432` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

## –†–∞–±–æ—Ç–∞ —Å –ú–∏–≥—Ä–∞—Ü–∏—è–º–∏ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –†–µ—à–µ–Ω–∏–µ Multi-Head –°—Ü–µ–Ω–∞—Ä–∏–µ–≤

–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:

```
Multiple head revisions are present for given argument 'head'
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ `migrations/versions/` –ø–æ—è–≤–∏–ª–∏—Å—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –≤–µ—Ç–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π** (–≥–æ–ª–æ–≤).

#### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–µ –≥–æ–ª–æ–≤—ã –º–∏–≥—Ä–∞—Ü–∏–π:**
  ```bash
  poetry run alembic heads
  ```

2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π:**
  ```bash
  poetry run alembic history --verbose | tail -n 20
  ```

#### –†–µ—à–µ–Ω–∏–µ

1. **–°–æ–∑–¥–∞–π—Ç–µ merge-–º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≥–æ–ª–æ–≤:**
  ```bash
  poetry run alembic merge -m "merge heads: unify branches" <head1> <head2> [<head3>...]
  ```

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
  ```bash
  poetry run alembic upgrade head
  ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  ```bash
  poetry run alembic heads
  ```

  –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω head**.

#### –ü—Ä–∏–º–µ—Ä

```bash
# 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
poetry run alembic heads
# –í—ã–≤–æ–¥: 20240911001000, 20250922000000

# 2. –°–æ–∑–¥–∞–Ω–∏–µ merge-–º–∏–≥—Ä–∞—Ü–∏–∏
poetry run alembic merge -m "merge heads: unify 20240911001000 and 20250922000000" 20240911001000 20250922000000

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
poetry run alembic upgrade head

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
poetry run alembic heads
# –í—ã–≤–æ–¥: —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω head (–Ω–æ–≤–∞—è merge-–º–∏–≥—Ä–∞—Ü–∏—è)
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

- **–í production:** –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ multi-head –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è** —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –æ—à–∏–±–∫–æ–π –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é.
- **–í development:** –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ multi-head –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É** —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –≤ –ª–æ–≥–∞—Ö, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å ASAP.

–î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
poetry run python -c "from app.core.migrations_health import log_migration_status; log_migration_status()"
```

#### –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞

- –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –±–∞–∑–µ **—Ç–µ–∫—É—â–µ–≥–æ head**: `down_revision` –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫—Ä–∞–π–Ω—é—é —Ä–µ–≤–∏–∑–∏—é.
- –ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π rebase** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π.
- CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API 1–°

–î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ API-–∫—Ä–µ–¥–æ–≤ (URL, –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å) –∏–∑ `.env` —Ñ–∞–π–ª–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç.

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à `.env` —Ñ–∞–π–ª –∑–∞–ø–æ–ª–Ω–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è `API_1C_*`.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
poetry run python scripts/test_1c_connection.py
```

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

## –ó–∞–ø—É—Å–∫ –¢–µ—Å—Ç–æ–≤

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–º–æ–¥—É–ª—å–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
poetry run pytest
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Å—Ç—Ä–æ–≥—É—é –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–∏—Å—Ç–æ—Ç—ã –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –∏ –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ `PROJECT_STRUCTURE.md`.

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä `asyncpg` —á–µ—Ä–µ–∑ SQLAlchemy 2.x. –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `integration_logs` —Å–æ–∑–¥–∞—ë—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–µ–π –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –≤ —Ä–µ–∂–∏–º–µ read-only.

### API Endpoints

- `POST /api/v1/trigger/internal-replenishment`: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.

### –§–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (`APScheduler`) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Outbox: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ 1–° –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –ø—Ä–∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å–±–æ–µ API, –∑–∞–∫–∞–∑ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω.
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –ö–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å –≤ 9:00 –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞ –¥–µ—Ñ–∏—Ü–∏—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ.

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –°–µ—Ä–≤–∏—Å—ã

- API –°–µ—Ä–≤–∏—Å: http://localhost:8000
- API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs
- –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: http://localhost:8501

### –ó–∞–ø—É—Å–∫ –≤ Production

–í production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª `docker-compose.yml`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏–∑ GHCR:

```bash
docker compose up -d
```

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–º–µ–Ω–∏—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –æ–±—Ä–∞–∑–æ–≤ `ghcr.io/your-github-username/your-repo-name/...` –≤ `docker-compose.yml` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ghcr.io/<owner>/<repo>/app:latest`).

## CI/CD

–ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `main` GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω:

- –õ–∏–Ω—Ç–∏–Ω–≥ (`ruff`) –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (`mypy`).
- –¢–µ—Å—Ç—ã (`pytest`) —Å —Ç–µ—Å—Ç–æ–≤–æ–π PostgreSQL.
- –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker-–æ–±—Ä–∞–∑–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏ –≤ GitHub Container Registry (GHCR) —Å —Ç–µ–≥–∞–º–∏ `latest` –∏ SHA –∫–æ–º–º–∏—Ç–∞.

### –ê–ª–≥–æ—Ä–∏—Ç–º –†–∞–±–æ—Ç—ã

1. –ê–Ω–∞–ª–∏–∑ –¥–µ—Ñ–∏—Ü–∏—Ç–∞ –≤ 1–°: —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∏–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.
2. –ü–æ–∏—Å–∫ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö-–¥–æ–Ω–æ—Ä–∞—Ö: –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Å–∫–ª–∞–¥—ã "–ë–µ—Å—Ç—É–∂–µ–≤—ã—Ö" –∏ "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä".
3. –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è: –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ outbox –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è "–ó–∞–∫–∞–∑–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ" –≤ 1–°, –∑–∞—Ç–µ–º Outbox-–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Å–æ–∑–¥–∞—ë—Ç –¥–æ–∫—É–º–µ–Ω—Ç.
4. –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞: –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–∫–ª–∞–¥–∞—Ö, —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ outbox –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è "–ó–∞–∫–∞–∑–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è" –≤ –ú–æ–π–°–∫–ª–∞–¥; –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –≤ –ú–æ–π–°–∫–ª–∞–¥.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è Docker/Compose

- –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–µ Dockerfile: –æ–±–∞ –æ–±—Ä–∞–∑–∞ (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å) —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Poetry —Å –≤–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º `.venv` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –≤ dev: `docker-compose.dev.yml` —É–±–∏—Ä–∞–µ—Ç `image:` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `build` —Å `Dockerfile`/`Dockerfile.admin`.
- –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ Python –∏–∑ `.venv` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∫–ª—é—á—ë–Ω `--reload`.

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

- –î–æ–±–∞–≤–∏—Ç—å runtime‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):
  `docker compose -f docker-compose.dev.yml run --rm app poetry add <package-name>`
- –î–æ–±–∞–≤–∏—Ç—å dev‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–∞–¥–º–∏–Ω–∫–∞/–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã):
  `docker compose -f docker-compose.dev.yml run --rm admin_panel poetry add -G dev <package-name>`
- –û–±–Ω–æ–≤–∏—Ç—å lock‚Äë—Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ –≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º `.venv` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
  `& .\.venv\Scripts\Activate.ps1; poetry lock`
- –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
  `docker compose -f docker-compose.dev.yml up -d --build`

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `poetry add` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–µ–Ω—è–µ—Ç —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –æ–±–Ω–æ–≤–ª—è–π—Ç–µ lock –ª–æ–∫–∞–ª—å–Ω–æ (–∫–∞–∫ –≤—ã—à–µ) –∏–ª–∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã.
